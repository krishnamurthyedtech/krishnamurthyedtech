<!DOCTYPE html>
<html lang="en">

<head>
    <title>Job Listings - KrishnamurthyEdTech</title>
    <link rel="icon" href="./images/logo/logo_kmedtech.png" type="image/png">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="description" content="Job listings at KrishnamurthyEdTech">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/owl.carousel.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="css/templatemo-style.css">
    <link rel="stylesheet" href="css/sheet.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-bar input,
        .filter-bar select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
        }

        .filter-bar input {
            flex: 1;
            min-width: 250px;
        }

        .filter-bar select {
            min-width: 150px;
        }

        .job-grid {
            display: grid;
            /* responsive columns with consistent card widths */
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
            padding: 0 8px; /* small side padding so cards aren't flush to container edges */
            justify-items: stretch;
        }

        .job-card {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* header at top, footer at bottom */
            align-items: stretch;
            aspect-ratio: 1 / 1; /* make card square */
            overflow: hidden; /* hide overflow inside square */
            min-width: 180px;
        }

        /* make the middle area scrollable if content overflows the square */
        .job-card .job-body {
            flex: 1 1 auto;
            overflow: auto;
            margin-top: 8px;
            margin-bottom: 8px;
        }

        /* ensure footer and header don't shrink too much */
        .job-card .job-header,
        .job-card .job-footer {
            flex: 0 0 auto;
        }

        .job-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .job-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .company-logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #29ca8e 0%, #4ba272 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            flex-shrink: 0;
        }

        .job-info {
            flex: 1;
            min-width: 0; /* allow content to shrink inside flex container */
        }

        .job-title {
            font-size: 18px;
            font-weight: 600;
            color: #049c55;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .company-name {
            font-size: 14px;
            color: #7f8c8d;
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .job-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            color: #555;
        }

        .detail-item svg {
            width: 16px;
            height: 16px;
        }

        .job-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .tag {
            background: #e8f4f8;
            color: #2980b9;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
        }

        .job-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid #ecf0f1;
        }

        .salary {
            font-size: 16px;
            font-weight: 600;
            color: #27ae60;
        }

        .posted-time {
            font-size: 12px;
            color: #95a5a6;
        }

        .apply-btn {
            background: #29ca8e;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .apply-btn:hover {
            background: #2980b9;
        }

        @media (max-width: 1200px) {
            .job-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .job-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .job-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body id="top" data-spy="scroll" data-target=".navbar-collapse" data-offset="50">

    <!-- MENU -->
    <section class="navbar custom-navbar navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon icon-bar"></span>
                    <span class="icon icon-bar"></span>
                    <span class="icon icon-bar"></span>
                </button>
                <!-- lOGO TEXT HERE -->
                <a href="index.html" class="navbar-brand" aria-label="Home">
                    <img src="./images/logo/logo_kmedtech.png" alt="KrishnamurthyEdTech" width="200" height="70">
                </a>
            </div>

            <!-- MENU LINKS -->
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-nav-first">
                    <li><a href="index.html#courses">Courses</a></li>
                    <li><a href="job-support.html">Job Support</a></li>
                    <li><a href="index.html#team">Teachers</a></li>
                    <li><a href="index.html#clients">Clients</a></li>
                    <li><a href="index.html#blog">Blogs</a></li>
                    <!-- <li><a href="#student-reviews">Reviews</a></li> -->
                    <li><a href="jobs.html">Jobs</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                    <li>
                        <button type="button" class="register-now-butto" data-toggle="modal"
                            data-target="#demoModal">
                            Book A Demo
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <!-- DEMO & REGISTER MODALS (copied from index) -->
    <div class="modal fade" id="demoModal" tabindex="-1" role="dialog" aria-labelledby="demoModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content p-4">
                <div class="modal-header border-0 pb-2 d-flex justify-content-center align-items-center">
                    <h4 class="modal-title font-weight-bold m-0 " id="demoModalLabel">Book A Demo Now</h4>
                    <button type="button" class="close position-absolute" style="right:20px;" data-dismiss="modal"
                        aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body pt-0">

                    <!-- Right Form -->
                    <div class="col-md-12">
                        <form id="demoForm">
                            <!-- Row for Name and Email -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="username" class="form-label">Name <span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="username" placeholder="Enter Name">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="email" class="form-label">Email <span
                                                class="text-danger">*</span></label>
                                        <input type="email" class="form-control" id="email" placeholder="Email">
                                    </div>
                                </div>
                            </div>
                            <!-- (truncated for brevity) -->
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="container">
        <div class="header">
            <h1>Find Your Dream Job</h1>
        </div>

        <div class="filter-bar">
            <input type="text" placeholder="Search jobs by title, company, or keyword..." id="searchInput">
            <select id="locationFilter">
                <option value="">All Locations</option>
                <option value="remote">Remote</option>
                <option value="bengaluru">Bengaluru</option>
                <option value="mumbai">Mumbai</option>
                <option value="delhi">Delhi</option>
            </select>
            <select id="typeFilter">
                <option value="">Job Type</option>
                <option value="full-time">Full Time</option>
                <option value="part-time">Part Time</option>
                <option value="contract">Contract</option>
            </select>
        </div>

        <div class="job-grid" id="jobGrid">
            <!-- Job cards will be dynamically generated -->
        </div>
        <div id="paginationControls" style="text-align:center;margin:20px;"></div>
    </div>

    <script>
        // Configuration
        const ORG_ID = 352; // Organization id used in your API example
        const BASE_URL = 'https://pioneercoders.krishnamurthyedtechapi.com/api/v1';
        const PAGE_SIZE = 10;

        // You can set token in localStorage under 'authToken' OR directly below for testing
        const AUTH_TOKEN = localStorage.getItem('authToken') || '';

        // State
        let currentPage = 0;
        let totalPages = 1;
        let rawJobs = []; // raw items returned by API for the current page
        let currentJobs = []; // normalized version used for rendering
        let roleFilter = '';

        // Helpers
        function initials(text) {
            if (!text) return 'NA';
            return text.split(' ').map(s => s[0]).slice(0,2).join('').toUpperCase();
        }

        function timeAgo(tsSeconds) {
            if (!tsSeconds) return '';
            const diff = Date.now()/1000 - tsSeconds;
            if (diff < 60) return Math.floor(diff) + 's ago';
            if (diff < 3600) return Math.floor(diff/60) + 'm ago';
            if (diff < 86400) return Math.floor(diff/3600) + 'h ago';
            return Math.floor(diff/86400) + 'd ago';
        }

        function showLoader() {
            document.getElementById('jobGrid').innerHTML = '<p style="text-align:center;width:100%">Loading jobs‚Ä¶</p>';
            document.getElementById('paginationControls').innerHTML = '';
        }

        function showError(msg) {
            document.getElementById('jobGrid').innerHTML = `<p style="text-align:center;color:#e74c3c">${msg}</p>`;
            document.getElementById('paginationControls').innerHTML = '';
        }

        function renderJobs(jobsToRender) {
            const jobGrid = document.getElementById('jobGrid');
            if (!jobsToRender || jobsToRender.length === 0) {
                jobGrid.innerHTML = '<p style="text-align:center;width:100%">No jobs found.</p>';
                return;
            }
            jobGrid.innerHTML = jobsToRender.map(job => `
                <div class="job-card" onclick="viewJob(${job.id})">
                    <div class="job-header">
                                <a href="${job.companyUrl ? job.companyUrl : 'index.html'}" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();">
                            <div class="company-logo">${job.logo || initials(job.company)}</div>
                        </a>
                        <div class="job-info">
                            <div class="job-title">${job.title}</div>
                            <div class="company-name">${job.company}</div>
                        </div>
                    </div>

                    <div class="job-body">
                        <div class="job-details">
                            <div class="detail-item">üìç ${job.location || ''}</div>
                            <div class="detail-item">üíº ${job.experience || job.type || ''}</div>
                        </div>

                        <div class="job-tags">
                            ${(job.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    </div>

                    <div class="job-footer">
                        <div>
                            <div class="salary">${job.salary || ''}</div>
                            <div class="posted-time">${job.posted || ''}</div>
                        </div>
                        <button class="apply-btn" onclick="event.stopPropagation(); applyJob(${job.id})">Apply</button>
                    </div>
                </div>
            `).join('');

            renderPagination();
        }

        function renderPagination() {
            const ctr = document.getElementById('paginationControls');
            const prevDisabled = currentPage <= 0 ? 'disabled' : '';
            const nextDisabled = currentPage >= totalPages - 1 ? 'disabled' : '';
            ctr.innerHTML = `
                <button ${prevDisabled} onclick="changePage(${currentPage - 1})">&laquo; Prev</button>
                <span style="margin:0 12px">Page ${currentPage + 1} of ${totalPages}</span>
                <button ${nextDisabled} onclick="changePage(${currentPage + 1})">Next &raquo;</button>
            `;
        }

        function changePage(page) {
            if (page < 0 || page >= totalPages) return;
            fetchJobs(page);
        }

        function applyJob(jobId) {
            // try to find the raw job object (full API response) first
            const raw = rawJobs.find(j => String(j.id) === String(jobId));
            const job = raw ? raw : (currentJobs.find(j => String(j.id) === String(jobId)) || { id: jobId });
            // store full raw job if available so jobsapply.html can display complete details
            sessionStorage.setItem('selectedJob', JSON.stringify(raw ? raw : job));
            window.location.href = `jobsapply.html?jobId=${jobId}`;
        }

        function viewJob(jobId) {
            const raw = rawJobs.find(j => String(j.id) === String(jobId));
            const job = raw ? raw : (currentJobs.find(j => String(j.id) === String(jobId)) || { id: jobId });
            sessionStorage.setItem('selectedJob', JSON.stringify(raw ? raw : job));
            window.location.href = `jobsapply.html?jobId=${jobId}`;
        }

        async function fetchJobs(page = 0, size = PAGE_SIZE) {
            showLoader();
            currentPage = page;
            try {
                const url = `${BASE_URL}/${ORG_ID}/job/search?size=${size}&page=${page}`;
                const body = JSON.stringify({ role: roleFilter || '' });
                const headers = { 'Content-Type': 'application/json', 'Accept': 'application/json' };
                if (AUTH_TOKEN) headers['Authorization'] = `Bearer ${AUTH_TOKEN}`;

                const res = await fetch(url, { method: 'POST', headers, body });
                if (!res.ok) throw new Error(`Server returned ${res.status}`);
                const json = await res.json();

                // Response shape expected: { metaData: { size, totalPages, page, totalElements }, data: [ ... ] }
                totalPages = (json.metaData && json.metaData.totalPages) || 1;
                currentPage = (json.metaData && json.metaData.page) || page;

                // Save raw jobs and normalize for rendering
                rawJobs = (json.data || []);
                currentJobs = rawJobs.map(j => ({
                    id: j.id,
                    title: j.role || j.title || j.name || 'Job',
                    company: j.name || j.clientName || '',
                    companyUrl: j.website || j.url || j.companyUrl || j.websiteUrl || '',
                    logo: j.logo || initials(j.name || j.clientName || ''),
                    location: j.location || '',
                    experience: j.experience || '',
                    type: j.type || j.jobStatus || '',
                    salary: j.salary || '',
                    tags: j.skills || (j.primarySkill ? [j.primarySkill] : []),
                    posted: timeAgo(j.postedOn || j.createdAt)
                }));

                // Apply client-side filters (location/type/search) if present
                const filtered = applyClientFilters(currentJobs);
                renderJobs(filtered);
            } catch (err) {
                console.error(err);
                showError('Could not load jobs. Please try again later.');
            }
        }

        function applyClientFilters(jobsArr) {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const locationFilter = document.getElementById('locationFilter').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value.toLowerCase();

            return jobsArr.filter(job => {
                const matchesSearch = !searchTerm || (job.title && job.title.toLowerCase().includes(searchTerm)) || (job.company && job.company.toLowerCase().includes(searchTerm)) || (job.tags && job.tags.some(t => t.toLowerCase().includes(searchTerm)));
                const matchesLocation = !locationFilter || (job.location && job.location.toLowerCase() === locationFilter);
                const matchesType = !typeFilter || (job.type && job.type.toLowerCase().replace(' ', '-') === typeFilter);
                return matchesSearch && matchesLocation && matchesType;
            });
        }

        // Debounce search
        let searchTimeout;
        document.getElementById('searchInput').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                // update roleFilter to search term so server can use it if desired
                roleFilter = e.target.value.trim();
                fetchJobs(0);
            }, 300);
        });

        document.getElementById('locationFilter').addEventListener('change', () => renderJobs(applyClientFilters(currentJobs)));
        document.getElementById('typeFilter').addEventListener('change', () => renderJobs(applyClientFilters(currentJobs)));

        // Initial load
        fetchJobs(0);
    </script>

    <!-- SCRIPTS -->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/smoothscroll.js"></script>
    <script src="js/custom.js"></script>

</body>

</html>
